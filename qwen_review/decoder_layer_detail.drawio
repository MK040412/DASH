<?xml version="1.0" encoding="UTF-8"?>
<mxfile>
<diagram name="Decoder Layer Detail" id="decoder_layer">
<mxGraphModel dx="1400" dy="1800" grid="1" gridSize="10" guides="1">
<root>
<mxCell id="0"/>
<mxCell id="1" parent="0"/>
<mxCell id="2" value="&lt;b&gt;(a) Qwen3VLTextDecoderLayer — Pre-LN Architecture&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#333333;fontSize=14;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="20" y="10" width="500" height="28" as="geometry"/></mxCell>
<mxCell id="3" value="28 layers × (GQA Attention + SwiGLU MLP) + DeepStack on layers 0,1,2" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#666;fontSize=9;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="20" y="36" width="500" height="18" as="geometry"/></mxCell>
<mxCell id="4" value="Input: &lt;b&gt;hidden_states&lt;/b&gt;
(B, S, 3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="40" y="434" width="260" height="44" as="geometry"/></mxCell>
<mxCell id="5" value="&lt;b&gt;input_layernorm&lt;/b&gt;
RMSNorm(3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="40" y="384" width="260" height="40" as="geometry"/></mxCell>
<mxCell id="6" value="&lt;b&gt;self_attn&lt;/b&gt;
Qwen3VLTextAttention
(GQA: 28Q / 4KV heads)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="40" y="322" width="260" height="52" as="geometry"/></mxCell>
<mxCell id="7" value="&lt;b&gt;⊕ Residual&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="40" y="284" width="260" height="28" as="geometry"/></mxCell>
<mxCell id="8" value="&lt;b&gt;post_attention_layernorm&lt;/b&gt;
RMSNorm(3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="40" y="234" width="260" height="40" as="geometry"/></mxCell>
<mxCell id="9" value="&lt;b&gt;mlp&lt;/b&gt;
Qwen3VLTextMLP
(SwiGLU: 3584→18944→3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f57f17;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="40" y="172" width="260" height="52" as="geometry"/></mxCell>
<mxCell id="10" value="&lt;b&gt;⊕ Residual&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="40" y="134" width="260" height="28" as="geometry"/></mxCell>
<mxCell id="11" value="Output: &lt;b&gt;hidden_states&lt;/b&gt;
(B, S, 3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="40" y="80" width="260" height="44" as="geometry"/></mxCell>
<mxCell id="12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="4" target="5"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="5" target="6"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="6" target="7"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="7" target="8"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="8" target="9"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="9" target="10"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="10" target="11"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="19" value="residual" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#999999;fontSize=9;strokeWidth=1;dashed=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="4" target="7"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="20" value="residual" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#999999;fontSize=9;strokeWidth=1;dashed=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="7" target="10"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="21" value="&lt;b&gt;DeepStack Injection&lt;/b&gt;
(layers 0, 1, 2 only)
h[vis_mask] += visual_embeds" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c62828;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="315" y="70" width="220" height="52" as="geometry"/></mxCell>
<mxCell id="22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#c62828;fontSize=9;strokeWidth=2;exitX=1;exitY=0.3;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="11" target="21"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="23" value="(B, S, 3584)" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#6c8ebf;fontSize=8;fontStyle=0;align=left;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="305" y="446" width="110" height="16" as="geometry"/></mxCell>
<mxCell id="24" value="(B, S, 3584)" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#9673a6;fontSize=8;fontStyle=0;align=left;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="305" y="338" width="110" height="16" as="geometry"/></mxCell>
<mxCell id="25" value="(B, S, 3584)" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#d6b656;fontSize=8;fontStyle=0;align=left;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="305" y="188" width="110" height="16" as="geometry"/></mxCell>
<mxCell id="26" value="&lt;b&gt;(b) Qwen3VLTextAttention — Grouped Query Attention&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#333333;fontSize=14;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="540" y="10" width="520" height="28" as="geometry"/></mxCell>
<mxCell id="27" value="28 query heads, 4 KV heads (7:1 GQA ratio), head_dim=128" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#666;fontSize=9;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="540" y="36" width="520" height="18" as="geometry"/></mxCell>
<mxCell id="28" value="Input: &lt;b&gt;hidden_states&lt;/b&gt;
(B, S, 3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="640" y="610" width="300" height="40" as="geometry"/></mxCell>
<mxCell id="29" value="&lt;b&gt;q_proj&lt;/b&gt;
Linear(3584→3584)
bias=True" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="550" y="550" width="120" height="50" as="geometry"/></mxCell>
<mxCell id="30" value="&lt;b&gt;k_proj&lt;/b&gt;
Linear(3584→512)
bias=True" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="680" y="550" width="120" height="50" as="geometry"/></mxCell>
<mxCell id="31" value="&lt;b&gt;v_proj&lt;/b&gt;
Linear(3584→512)
bias=True" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="810" y="550" width="120" height="50" as="geometry"/></mxCell>
<mxCell id="32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="28" target="29"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="28" target="30"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="28" target="31"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="35" value="&lt;b&gt;q_norm&lt;/b&gt;
RMSNorm(128)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="550" y="505" width="120" height="36" as="geometry"/></mxCell>
<mxCell id="36" value="&lt;b&gt;k_norm&lt;/b&gt;
RMSNorm(128)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="680" y="505" width="120" height="36" as="geometry"/></mxCell>
<mxCell id="37" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="29" target="35"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="30" target="36"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="39" value="→ (B, 28, S, 128)" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#666;fontSize=8;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="550" y="487" width="120" height="16" as="geometry"/></mxCell>
<mxCell id="40" value="→ (B, 4, S, 128)" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#666;fontSize=8;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="680" y="487" width="120" height="16" as="geometry"/></mxCell>
<mxCell id="41" value="→ (B, 4, S, 128)" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#666;fontSize=8;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="810" y="532" width="120" height="16" as="geometry"/></mxCell>
<mxCell id="42" value="&lt;b&gt;M-RoPE&lt;/b&gt;
3D position
(t, h, w)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f7fa;strokeColor=#00838f;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="550" y="449" width="120" height="44" as="geometry"/></mxCell>
<mxCell id="43" value="&lt;b&gt;M-RoPE&lt;/b&gt;
3D position
(t, h, w)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f7fa;strokeColor=#00838f;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="680" y="449" width="120" height="44" as="geometry"/></mxCell>
<mxCell id="44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="35" target="42"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="36" target="43"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="46" value="&lt;b&gt;KV Cache&lt;/b&gt;
DynamicCache
update(K, V)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#3949ab;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="680" y="409" width="250" height="34" as="geometry"/></mxCell>
<mxCell id="47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="43" target="46"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#3949ab;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.8;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="31" target="46"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="49" value="&lt;b&gt;Scaled Dot-Product Attention&lt;/b&gt;
softmax(QK&lt;sup&gt;T&lt;/sup&gt; / √128) · V
GQA: 7 Q heads share 1 KV head
causal mask applied" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="550" y="357" width="380" height="48" as="geometry"/></mxCell>
<mxCell id="50" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="42" target="49"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="46" target="49"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="52" value="&lt;b&gt;o_proj&lt;/b&gt;
Linear(3584→3584, bias=True)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="600" y="313" width="280" height="36" as="geometry"/></mxCell>
<mxCell id="53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="49" target="52"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="54" value="Output: &lt;b&gt;attn_output&lt;/b&gt;
(B, S, 3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="640" y="273" width="300" height="36" as="geometry"/></mxCell>
<mxCell id="55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="52" target="54"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="56" value="&lt;b&gt;GQA 7:1&lt;/b&gt;
Q heads: 28
KV heads: 4
Groups: 4
7 Q per KV" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#e65100;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="950" y="352" width="120" height="80" as="geometry"/></mxCell>
<mxCell id="57" value="&lt;b&gt;(c) Qwen3VLTextMLP — SwiGLU Feed-Forward&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#333333;fontSize=14;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="20" y="650" width="400" height="28" as="geometry"/></mxCell>
<mxCell id="58" value="Gated Linear Unit with SiLU activation, no bias on projections" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#666;fontSize=9;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="20" y="676" width="400" height="18" as="geometry"/></mxCell>
<mxCell id="59" value="Input: &lt;b&gt;x&lt;/b&gt;
(B, S, 3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="90" y="1060" width="240" height="36" as="geometry"/></mxCell>
<mxCell id="60" value="&lt;b&gt;gate_proj&lt;/b&gt;
Linear(3584→18944)
bias=False" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1006" width="150" height="48" as="geometry"/></mxCell>
<mxCell id="61" value="&lt;b&gt;up_proj&lt;/b&gt;
Linear(3584→18944)
bias=False" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="230" y="1006" width="150" height="48" as="geometry"/></mxCell>
<mxCell id="62" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="59" target="60"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="59" target="61"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="64" value="&lt;b&gt;SiLU()&lt;/b&gt;
σ(x) · x" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="966" width="150" height="34" as="geometry"/></mxCell>
<mxCell id="65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="60" target="64"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="66" value="&lt;b&gt;⊙ Element-wise Multiply&lt;/b&gt;
SiLU(gate) * up
(B, S, 18944)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#efebe9;strokeColor=#5d4037;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="70" y="924" width="260" height="40" as="geometry"/></mxCell>
<mxCell id="67" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="64" target="66"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="68" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="61" target="66"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="69" value="&lt;b&gt;down_proj&lt;/b&gt;
Linear(18944→3584)
bias=False" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="100" y="880" width="210" height="38" as="geometry"/></mxCell>
<mxCell id="70" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="66" target="69"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="71" value="Output: &lt;b&gt;mlp_output&lt;/b&gt;
(B, S, 3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="90" y="842" width="240" height="34" as="geometry"/></mxCell>
<mxCell id="72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="69" target="71"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="73" value="&lt;b&gt;SwiGLU(x) = (SiLU(W_gate · x) ⊙ W_up · x) · W_down&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#5d4037;fontSize=10;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="30" y="812" width="350" height="22" as="geometry"/></mxCell>
<mxCell id="74" value="(B, S, 18944)" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#666;fontSize=8;fontStyle=0;align=left;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="190" y="1020" width="100" height="16" as="geometry"/></mxCell>
<mxCell id="75" value="&lt;b&gt;(d) DeepStack: _deepstack_process()&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#333333;fontSize=14;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="440" y="650" width="400" height="28" as="geometry"/></mxCell>
<mxCell id="76" value="Visual features injected into LLM hidden states at layers 0, 1, 2" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#666;fontSize=9;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="440" y="676" width="400" height="18" as="geometry"/></mxCell>
<mxCell id="77" value="Input: &lt;b&gt;hidden_states&lt;/b&gt;
(B, S, 3584) — full sequence" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="460" y="990" width="300" height="44" as="geometry"/></mxCell>
<mxCell id="78" value="&lt;b&gt;visual_pos_masks&lt;/b&gt;
Boolean mask → visual token positions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#3949ab;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="460" y="940" width="300" height="40" as="geometry"/></mxCell>
<mxCell id="79" value="&lt;b&gt;h[vis_mask, :].clone()&lt;/b&gt;
Extract visual positions
(B, N_vis, 3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="460" y="882" width="300" height="48" as="geometry"/></mxCell>
<mxCell id="80" value="&lt;b&gt;⊕ Add visual_embeds&lt;/b&gt;
from DeepStack PatchMerger
(N_vis, 3584)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c62828;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="460" y="824" width="300" height="48" as="geometry"/></mxCell>
<mxCell id="81" value="&lt;b&gt;h[vis_mask, :] = result&lt;/b&gt;
Write back to original positions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c62828;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="460" y="774" width="300" height="40" as="geometry"/></mxCell>
<mxCell id="82" value="Output: &lt;b&gt;hidden_states&lt;/b&gt;
(B, S, 3584) — updated" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="460" y="720" width="300" height="44" as="geometry"/></mxCell>
<mxCell id="83" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="77" target="78"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="78" target="79"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="85" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="79" target="80"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="80" target="81"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="87" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#333333;fontSize=9;strokeWidth=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="81" target="82"><mxGeometry relative="1" as="geometry"/></mxCell>
<mxCell id="88" value="Mapping:
Layer 0 ← VisionBlock 8 → Merger₀
Layer 1 ← VisionBlock 16 → Merger₁
Layer 2 ← VisionBlock 24 → Merger₂" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c62828;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="770" y="814" width="210" height="72" as="geometry"/></mxCell>
<mxCell id="89" value="⚠ Only on layers 0, 1, 2 (len(deepstack_visual_indexes))" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#c62828;fontSize=9;fontStyle=1;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="460" y="1045" width="300" height="18" as="geometry"/></mxCell>
<mxCell id="90" value="&lt;b&gt;(e) Qwen3-VL-7B Decoder Configuration&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontColor=#333333;fontSize=13;fontStyle=0;align=center;verticalAlign=middle;" vertex="1" parent="1"><mxGeometry x="20" y="1100" width="600" height="25" as="geometry"/></mxCell>
<mxCell id="91" value="&lt;b&gt;Parameter&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1130" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="92" value="&lt;b&gt;Value&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1130" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="93" value="&lt;b&gt;Notes&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=9;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1130" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="94" value="hidden_size" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1158" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="95" value="3584" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1158" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="96" value="LLM hidden dimension" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1158" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="97" value="num_hidden_layers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1186" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="98" value="28" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1186" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="99" value="Decoder layers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1186" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="100" value="num_attention_heads" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1214" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="101" value="28" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1214" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="102" value="Query heads" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1214" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="103" value="num_key_value_heads" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1242" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="104" value="4" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1242" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="105" value="KV heads (GQA ratio 7:1)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1242" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="106" value="head_dim" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1270" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="107" value="128" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1270" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="108" value="3584 / 28" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1270" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="109" value="intermediate_size" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1298" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="110" value="18944" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1298" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="111" value="SwiGLU intermediate (≈5.29× hidden)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1298" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="112" value="hidden_act" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1326" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="113" value="silu" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1326" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="114" value="SiLU = Swish = x·σ(x)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1326" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="115" value="attention_bias" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1354" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="116" value="True" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1354" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="117" value="Q, K, V, O all have bias" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1354" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="118" value="rms_norm_eps" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1382" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="119" value="1e-6" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1382" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="120" value="RMSNorm epsilon" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1382" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="121" value="Norm type" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1410" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="122" value="RMSNorm" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1410" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="123" value="NOT LayerNorm (Vision uses LayerNorm)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1410" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="124" value="Q/K per-head norm" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1438" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="125" value="RMSNorm(128)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1438" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="126" value="q_norm, k_norm applied after projection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1438" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="127" value="Position encoding" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1466" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="128" value="M-RoPE (3D)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1466" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="129" value="Interleaved: temporal, height, width" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1466" width="280" height="26" as="geometry"/></mxCell>
<mxCell id="130" value="DeepStack layers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#1565c0;fontSize=8;fontStyle=1;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="30" y="1494" width="170" height="26" as="geometry"/></mxCell>
<mxCell id="131" value="0, 1, 2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="202" y="1494" width="150" height="26" as="geometry"/></mxCell>
<mxCell id="132" value="Visual injection from ViT blocks 8, 16, 24" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=8;fontStyle=0;arcSize=8;verticalAlign=middle;align=center;" vertex="1" parent="1"><mxGeometry x="354" y="1494" width="280" height="26" as="geometry"/></mxCell>
</root>
</mxGraphModel>
</diagram>
</mxfile>